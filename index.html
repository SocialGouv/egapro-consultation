<!DOCTYPE html>
<html lang="fr">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<title>L'index d'égalité dans les entreprises - Ministère du Travail</title>
<link rel="stylesheet" href="assets/css/consultation.css">
<script>
  // First, check the browser is compatible
  try {
    eval("async function _(){}")
    eval("new FormData().entries()")
  } catch (e) {
      window.location.href = 'https://index-egapro.travail.gouv.fr/declaration/compatibilite.html';
  }
</script>
<script
  src="assets/js/sentry.min.js"
  integrity="sha384-ir4+BihBClNpjZk3UKgHTr0cwRhujAjy/M5VEGvcOzjhM1Db79GAg9xLxYn4uVK4"
  crossorigin="anonymous"
></script>
<script>
  if (typeof Sentry !== "undefined") {
    Sentry.init({
      dsn: 'https://c98522783c284ae1ada779bc05a57a96@sentry.fabrique.social.gouv.fr/51',
      release: '{{ site.version }}'
    })
  }
</script>

<div class="overlay">
  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="margin: auto; background: rgb(255, 255, 255) none repeat scroll 0% 0%; display: block; shape-rendering: auto;" width="200px" height="200px" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid">
    <path d="M10 50A40 40 0 0 0 90 50A40 42 0 0 1 10 50" fill="#967de1" stroke="none">
      <animateTransform attributeName="transform" type="rotate" dur="1s" repeatCount="indefinite" keyTimes="0;1" values="0 50 51;360 50 51"></animateTransform>
    </path>
    <!-- [ldio] generated by https://loading.io/ -->
  </svg>
  Chargement...
</div>

<header>
  <div class=content-wrapper>
    <a href="https://travail-emploi.gouv.fr/droit-du-travail/egalite-professionnelle-discrimination-et-harcelement/indexegapro" target="_blank">
      <img src="assets/img/marianne-header.png" alt="Ministère du travail, de l'emploi et de l'insertion. Liberté, égalité, fraternité">
    </a>
    <a href="/home">
      <img src="assets/img/logo.png" alt="Index Égalité Femme/Homme">
    </a>
    <hgroup>
    <h1><a href="https://index-egapro.travail.gouv.fr/">Index Égalité Professionnelle</a></h1>
    </hgroup>
    <p hidden>
      <a>Comment l'index est-il calculé ?</a>
    </p>
  </div>
</header>

<main>
  <% if(state.current_page == 'home' || state.filters.get('q')) { %>
  <article id="search">
    <form action="#!/search" class="row">
      <h1>Rechercher l'index de l'égalité professionnelle d'une entreprise de 1000 salariés ou plus</h1>
      <input type="search" name="q" value="<%= state.filters.get('q') %>" placeholder="Saisissez le nom ou le SIREN d'une entreprise" autofocus>
      <button class="button primary">Rechercher</button>
    </form>
  </article>
  <% } %>

  <% if (state.current_page == 'home') { %>
  <article id="average">
    <form action="#!/search" id=filter-index>
      <h1>Index moyen par critères</h1>

      <fieldset>
        <select name="region" title="Filtrer par région" onchange="calculateIndex(this.form)">
          <option value="">Région</option>
          <% Object.entries(state.config.REGIONS).sort((a, b) => a[1].localeCompare(b[1])).map(([code, name]) => { %>
          <option value="<%= code %>" selected="<%= state.filters.get('region') == code %>">
            <%= state.config.REGIONS[code] %>
          </option>
          <% }) %>
        </select>

        <select name="departement" title="Filtrer par département" onchange="calculateIndex(this.form)">
          <option value="">Département</option>
          <% Object.entries(state.config.DEPARTEMENTS)
            .sort((a, b) => a[1].localeCompare(b[1]))
            .filter(([code, name]) => state.filters.get('region')
              ? state.config.REGIONS_TO_DEPARTEMENTS[state.filters.get('region')].includes(code)
              : true)
            .map(([code, name]) => { %>
            <option value="<%= code %>" selected="<%= state.filters.get('departement') == code %>">
              <%= state.config.DEPARTEMENTS[code] %>
            </option>
          <% }) %>
        </select>

        <select name="section_naf" title="Filtrer par code NAF" onchange="calculateIndex(this.form)">
          <option value="">Secteur d'activité</option>
          <% for(code in state.config.SECTIONS_NAF){ %>
            <option value="<%= code %>" selected="<%= state.filters.get('section_naf') == code %>">
              <%= state.config.SECTIONS_NAF[code] %>
            </option>
          <% } %>
        </select>
      </fieldset>

      <p>
        <span><%= Math.round(state.stats.avg) %></span> Index moyen <%= state.current_year %>
      </p>
      <button class="button primary">Voir les entreprises correspondant à ces critères</button>
    </article>
  </form>


  <article id="download">
    <p>
      Vous souhaitez consulter les données de toutes les entreprises ?
      <br>
      Téléchargez le fichier recensant toutes les déclarations <span id="csv-date">
        <% if (state.csv_update) { %>
          au <%= state.csv_update %>
        <% } else { %>
          actuelles
        <% } %>
        <span> au format tableur (.csv) :
    </p>
    <a class="button" href="/index-egalite-fh.csv" download>⤓ Télécharger</a>
  </article>
  <% } %>

  <% if (state.current_page == 'search') { %>
  <article name="search">
    <div class="content-wrapper">
      <a href="/home" title="retour à la page d'accueil" class="navigation" onclick="setLoading(true)">&laquo; retour</a>
      <% if(!state.filters.get('q')) { %>
      <form action="#!/search">
        <p>Filtrer les <span><%= state.results.count %> résultats %></span></p>
        <fieldset>
          <select name="region" title="Filtrer par région" onchange="submitForm(this.form)">
            <option value="">Région</option>
            <% Object.entries(state.config.REGIONS).sort((a, b) => a[1].localeCompare(b[1])).map(([code, name]) => { %>
            <option value="<%= code %>" selected="<%= state.filters.get('region') == code %>">
              <%= state.config.REGIONS[code] %>
            </option>
            <% }) %>
          </select>

          <select name="departement" title="Filtrer par département" onchange="submitForm(this.form)">
            <option value="">Département</option>
            <% Object.entries(state.config.DEPARTEMENTS)
              .sort((a, b) => a[1].localeCompare(b[1]))
              .filter(([code, name]) => state.filters.get('region')
                ? state.config.REGIONS_TO_DEPARTEMENTS[state.filters.get('region')].includes(code)
                : true)
              .map(([code, name]) => { %>
              <option value="<%= code %>" selected="<%= state.filters.get('departement') == code %>">
                <%= state.config.DEPARTEMENTS[code] %>
              </option>
            <% }) %>
          </select>

          <select name="section_naf" title="Filtrer par code NAF" onchange="submitForm(this.form)">
            <option value="">Secteur d'activité</option>
            <% for(code in state.config.SECTIONS_NAF){ %>
              <option value="<%= code %>" selected="<%= state.filters.get('section_naf') == code %>">
                <%= state.config.SECTIONS_NAF[code] %>
              </option>
            <% } %>
          </select>
        </fieldset>
      </form>
      <% } %>
      <% if(state.results.data.length > 0) { %>
        <p><%= state.results.data.length %> sur <%= state.results.count %> résultats %></p>
      <% } else { %>
        <p id=no-result>Aucun résultat ne correspond à votre recherche. Veuillez adapter votre recherche.</p>
      <% } %>

      <% state.results.data.forEach((record) => { %>

      <article class=result>
        <header>
          <h1><%= record.entreprise.raison_sociale %></h1>
          <p>SIREN : <%= record.entreprise.siren %></p>
          <p class=department>Département : <%= state.config.DEPARTEMENTS[record.entreprise.département] %> (<%= record.entreprise.département %>)</p>
        </header>
        <section>
          <p>
            <% if(record.entreprise.effectif.tranche && record.entreprise.effectif.tranche.includes('1000')) { %>
              <span>1000</span> salariés ou plus
            <% } else { %>
              <span>251 à 1000</span> salariés
            <% } %>
          </p>
        </section>
        <% Object.entries(record.notes).sort().reverse().forEach((declaration) => { %>
          <section>
            <p>
              <span><% if (declaration[1] == null) { %><abbr title="Non calculable">NC</abbr><% } else { %><%= declaration[1] %><% } %></span>
              Index <%= Number(declaration[0]) + 1 %>
            </p>
          </section>
        <% }) %>
        <% if(record.entreprise.ues) { %>
          <details>
            <summary>Voir les entreprises composant l'UES</summary>
            <ol>
              <% record.entreprise.ues.entreprises.forEach(ues => { %>
                <li><%= ues.raison_sociale %> (Siren : <%= ues.siren %>)</li>
              <% }) %>
            </ol>
          </details>
        <% } %>
      </article>
      <% }) %>
      <% if(state.results.count > state.results.data.length) { %>
        <footer>
          <button onclick="moreResults()" class="button">Voir les résultats suivants…</button>
        </footer>
      <% } %>
    </div>
  </article>
  <% } %>

  <% if(state.current_page == '404') { %>
  <article name="404">
    La page demandée n'existe pas
  </article>
  <% } %>
</main>

<footer>
  <div class="content-wrapper">
    <section>
      <header>
        <a href="https://travail-emploi.gouv.fr/droit-du-travail/egalite-professionnelle-discrimination-et-harcelement/indexegapro" target="_blank">
          <img src="assets/img/marianne-footer.png" alt="Ministère du travail, de l'emploi et de l'insertion. Liberté, égalité, fraternité">
        </a>
      </header>
      <aside>
        <p>
          Porté par la loi « Pour la liberté de choisir son avenir professionel » du 5 septembre 2018, l'Index d'égalité professionnelle a été conçu pour faire progresser au sein des entreprises l'égalité salariale entre les femmes et les hommes.
        </p>
      </aside>
    </section>
    <nav>
      <a href="https://voxusagers.numerique.gouv.fr/Demarches/2240?&amp;view-mode=formulaire-avis&amp;nd_mode=en-ligne-enti%C3%A8rement&amp;nd_source=button&amp;key=73366ddb13d498f4c77d01c2983bab48" target="_blank" rel="noopener noreferrer">Donnez-nous votre avis</a>
      <a href="https://github.com/SocialGouv/egapro-consultation/tree/{{ site.version }}" target="_blank" rel="noopener noreferrer">Contribuez sur Github</a>
      <a href="mailto:index@travail.gouv.fr?subject=À propos du site de consultation">Contact</a>
    </nav>
  </div>
</footer>

<script src="assets/js/page.js"></script>
<script src="assets/js/ejs.js"></script>
<script src="assets/js/utils.js"></script>
<script src="assets/js/main.js"></script>
</html>
