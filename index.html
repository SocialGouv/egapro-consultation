<!DOCTYPE html>
<html lang="fr">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<title>À propos de la transmission des indicateurs et du niveau de résultat - Egalité professionnelle - Ministère du Travail</title>
<link rel="stylesheet" href="assets/css/consultation.css">
<script
  src="assets/js/sentry.min.js"
  integrity="sha384-ir4+BihBClNpjZk3UKgHTr0cwRhujAjy/M5VEGvcOzjhM1Db79GAg9xLxYn4uVK4"
  crossorigin="anonymous"
></script>
<script>
  if (typeof Sentry !== "undefined") {
    Sentry.init({
      dsn: 'https://c98522783c284ae1ada779bc05a57a96@sentry.fabrique.social.gouv.fr/51',
      release: '{{ site.version }}'
    })
  }
</script>

<header>
  <div>
    <a href="https://travail-emploi.gouv.fr/" target="_blank"><img src="assets/img/marianne.svg" alt="Marianne"></a>
    <img src="assets/img/logo.png" alt="Index Égalité Femme/Homme">
    <hgroup>
      <h1><a href="https://index-egapro.travail.gouv.fr/" target="_blank">Index Égalité Professionnelle</a></h1>
      <h2>La référence sur l'égalité F/H en entreprise</h2>
    </hgroup>
    <p>
      <a>Comment l'index est-il calculé ?</a>
    </p>
  </div>
</header>

<main>
  <article>
    <blockquote>
      L'index d'égalité Femmes-Hommes dans les entreprises de plus de 250 salarié•e•s
    </blockquote>
  </article>

  <article id=search>
    <h1>Recherche par entreprise</h1>
    <form action="/search" class="row" id="search-form">
      <input type="search" name="q" value="" placeholder="Tapez le nom d'une entreprise">
      <button rel="next"><img src="https://cdn3.iconfinder.com/data/icons/apply/32/apply_21-512.png" alt="Rechercher"></button>
    </form>
  </article>

  <page name="home"></page>

  <page name="search">
    <h1> <%= data.length %> Entreprises correspondent à cette recherche</h1>
    <% data.forEach((record) => { %>

    <article class=entreprise>
      <header>
        <h1><%= record.entreprise.raison_sociale %></h1>
        <p><small>Déclarations :
          <% Object.entries(record.notes).sort().reverse().forEach((declaration) => { %>
            <%= declaration[0] %>=<%= declaration[1] %>
          <% }) %>
        </small></p>
      </header>
      <section>
        <ul>
          <li>siren : <%= record.entreprise.siren %></li>
          <li>structure : <%= record.entreprise.ues ? "Unité Économique et Sociale" : "entreprise" %></li>
        </ul>
        <% if(record.entreprise.ues) { %>
          <details>
            <summary>Entreprises composant l'UES (<%= record.entreprise.ues.nom %>)</summary>
            <ul>
              <% record.entreprise.ues.entreprises.forEach((ues) => { %>
              <li><%= ues.raison_sociale%> (<%= ues.siren %>)</li>
              <% }) %>
            </ul>
          </details>
        <% } %>
      </section>
    </article>
    <% }) %>
  </page>

  <page name="404">
    La page demandée n'existe pas
  </page>
</main>

<footer>
  <div class="wrapper">
    <section>
      <header>
        <a href="https://travail-emploi.gouv.fr/" target="_blank">
          <img src="assets/img/marianne.svg" alt="Marianne">
        </a>
      </header>
      <p>
        Index Egapro a été développé par les équipes de la fabrique numérique des ministères sociaux. Pour nous aider à l'améliorer
        <a href="https://voxusagers.numerique.gouv.fr/Demarches/2240?&amp;view-mode=formulaire-avis&amp;nd_mode=en-ligne-enti%C3%A8rement&amp;nd_source=button&amp;key=73366ddb13d498f4c77d01c2983bab48" target="_blank" rel="noopener noreferrer">donnez-nous votre avis</a> ou <a href="https://github.com/SocialGouv/egapro-consultation/tree/{{ site.version }}" target="_blank" rel="noopener noreferrer">contribuez sur Github</a>
      </p>
    </section>
    <nav>
      <a href="https://travail-emploi.gouv.fr/droit-du-travail/egalite-professionnelle-discrimination-et-harcelement/indexegapro"
        target="_blank" rel="noopener noreferrer">retrouvez le simulateur au format Excel</a>
      <a href="https://index-egapro.travail.gouv.fr/mentions-legales">mentions légales</a>
      <a href="https://index-egapro.travail.gouv.fr/cgu">conditions
        générales d'utilisation</a>
      <a href="https://index-egapro.travail.gouv.fr/politique-confidentialite">politique de
        confidentialité</a>
    </nav>
  </div>
</footer>

<script src="assets/js/page.js"></script>
<script src="assets/js/ejs.js"></script>
<script src="assets/js/utils.js"></script>
<script>
  const config = {
    apiUrl: 'https://dev.egapro.fabrique.social.gouv.fr/api'
  }


  ////////////////
  /* Templating */
  ////////////////

  // Cache templates
  const templates = Array.from(document.querySelectorAll('page')).reduce((templates, page) => {
    const name = page.getAttribute('name')
    templates[name] = page.innerHTML
    return templates
  }, {})

  function getTemplate(name) {
    return templates[name].replaceAll('&lt;', '<').replaceAll('&gt;', '>')
  }

  function render(name, data) {
    Array.from(document.querySelectorAll('page')).forEach((page) => {
      page.removeAttribute('visible')
    })
    const page = document.querySelector(`page[name="${name}"]`)
    page.setAttribute('visible', 'visible')
    const html = getTemplate(name)
    page.innerHTML= ejs.render(html, data)
  }


  /////////////////
  /* Controllers */
  /////////////////

  // Enable query params for router. This must remain before specific routes.
  page('*', (req, next) => {
    req.query = new URLSearchParams(req.path.split('?')[1])
    next()
  })

  page('/', () => {
    render('home')
  })

  page('/search', async (req) => {
    const response = await request('GET', `${config.apiUrl}/search?${req.query}`)
    render('search', response.data)
  })

  page('*', () => {
    render('404')
  })

  page({ hashbang: true })

  // Route also form action as hashbang
  Array.from(document.querySelectorAll('form')).forEach((form) => {
    form.addEventListener('submit', (event) => {
      event.preventDefault()
      const queryParams = new URLSearchParams(new FormData(form))
      const pathname = new URL(form.action).pathname
      page(`${pathname}?${queryParams}`)
    })
  })
</script>

</html>
